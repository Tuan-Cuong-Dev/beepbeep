{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://D%3A/1.%202025/12.%20Code%20website/ebikerental/src/hooks/useSubscriptionPackageData.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { db } from '@/src/firebaseConfig';\r\nimport { \r\n  collection, \r\n  addDoc, \r\n  updateDoc, \r\n  deleteDoc, \r\n  getDocs, \r\n  doc, \r\n  query, \r\n  where, \r\n  serverTimestamp \r\n} from 'firebase/firestore';\r\nimport { SubscriptionPackage } from '@/src/lib/subscriptionPackages/subscriptionPackagesType';\r\n\r\nexport function useSubscriptionPackageData(companyId: string) {\r\n  const [packages, setPackages] = useState<SubscriptionPackage[]>([]);\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const fetchPackages = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const q = query(collection(db, 'subscriptionPackages'), where('companyId', '==', companyId));\r\n      const querySnapshot = await getDocs(q);\r\n      const data = querySnapshot.docs.map(docSnap => ({\r\n        id: docSnap.id,\r\n        ...docSnap.data()\r\n      })) as SubscriptionPackage[];\r\n      setPackages(data);\r\n    } catch (err) {\r\n      console.error('❌ Failed to fetch subscription packages:', err);\r\n      setError('Failed to load packages.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const createPackage = async (pkg: Omit<SubscriptionPackage, 'id' | 'createdAt' | 'updatedAt'>) => {\r\n    try {\r\n      const docRef = await addDoc(collection(db, 'subscriptionPackages'), {\r\n        ...pkg,\r\n        createdAt: serverTimestamp(),\r\n        updatedAt: serverTimestamp(),\r\n      });\r\n      setPackages(prev => [...prev, { ...pkg, id: docRef.id, createdAt: new Date(), updatedAt: new Date() }]);\r\n    } catch (err) {\r\n      console.error('❌ Failed to create subscription package:', err);\r\n      setError('Failed to create package.');\r\n    }\r\n  };\r\n\r\n  const updatePackage = async (id: string, pkg: Partial<SubscriptionPackage>) => {\r\n    try {\r\n      const docRef = doc(db, 'subscriptionPackages', id);\r\n      await updateDoc(docRef, {\r\n        ...pkg,\r\n        updatedAt: serverTimestamp(),\r\n      });\r\n      setPackages(prev =>\r\n        prev.map(p => (p.id === id ? { ...p, ...pkg, updatedAt: new Date() } : p))\r\n      );\r\n    } catch (err) {\r\n      console.error('❌ Failed to update subscription package:', err);\r\n      setError('Failed to update package.');\r\n    }\r\n  };\r\n\r\n  const deletePackage = async (id: string) => {\r\n    try {\r\n      const docRef = doc(db, 'subscriptionPackages', id);\r\n      await deleteDoc(docRef);\r\n      setPackages(prev => prev.filter(p => p.id !== id));\r\n    } catch (err) {\r\n      console.error('❌ Failed to delete subscription package:', err);\r\n      setError('Failed to delete package.');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (companyId) {\r\n      fetchPackages();\r\n    }\r\n  }, [companyId]);\r\n\r\n  return {\r\n    packages,\r\n    loading,\r\n    error,\r\n    fetchPackages,\r\n    createPackage,\r\n    updatePackage,\r\n    deletePackage,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file://D%3A/1.%202025/12.%20Code%20website/ebikerental/src/lib/subscriptionPackages/exportSubscriptionPackages.tsx"],"sourcesContent":["import * as XLSX from 'xlsx';\r\nimport { SubscriptionPackage } from './subscriptionPackagesType';\r\n\r\nexport function exportSubscriptionPackagesToExcel(packages: SubscriptionPackage[]) {\r\n  if (!packages.length) {\r\n    alert('No packages to export.');\r\n    return;\r\n  }\r\n\r\n  const data = packages.map(pkg => ({\r\n    'Package Name': pkg.name,\r\n    'Duration Type': pkg.durationType,\r\n    'KM Limit': pkg.kmLimit ?? 'Unlimited',\r\n    'Charging Method': pkg.chargingMethod,\r\n    'Base Price (VND)': pkg.basePrice,\r\n    'Overage Rate (VND/km)': pkg.overageRate ?? '-',\r\n    'Created At': pkg.createdAt?.toDate ? pkg.createdAt.toDate().toLocaleDateString() : '',\r\n  }));\r\n\r\n  const worksheet = XLSX.utils.json_to_sheet(data);\r\n  const workbook = XLSX.utils.book_new();\r\n  XLSX.utils.book_append_sheet(workbook, worksheet, 'SubscriptionPackages');\r\n\r\n  XLSX.writeFile(workbook, 'subscription_packages.xlsx');\r\n}\r\n"],"names":[],"mappings":";;;AAAA;;AAGO,SAAS,kCAAkC,QAA+B;IAC/E,IAAI,CAAC,SAAS,MAAM,EAAE;QACpB,MAAM;QACN;IACF;IAEA,MAAM,OAAO,SAAS,GAAG,CAAC,CAAA,MAAO,CAAC;YAChC,gBAAgB,IAAI,IAAI;YACxB,iBAAiB,IAAI,YAAY;YACjC,YAAY,IAAI,OAAO,IAAI;YAC3B,mBAAmB,IAAI,cAAc;YACrC,oBAAoB,IAAI,SAAS;YACjC,yBAAyB,IAAI,WAAW,IAAI;YAC5C,cAAc,IAAI,SAAS,EAAE,SAAS,IAAI,SAAS,CAAC,MAAM,GAAG,kBAAkB,KAAK;QACtF,CAAC;IAED,MAAM,YAAY,6HAAA,CAAA,QAAU,CAAC,aAAa,CAAC;IAC3C,MAAM,WAAW,6HAAA,CAAA,QAAU,CAAC,QAAQ;IACpC,6HAAA,CAAA,QAAU,CAAC,iBAAiB,CAAC,UAAU,WAAW;IAElD,CAAA,GAAA,6HAAA,CAAA,YAAc,AAAD,EAAE,UAAU;AAC3B","debugId":null}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"sources":["file://D%3A/1.%202025/12.%20Code%20website/ebikerental/app/subscriptionPackages/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { useSubscriptionPackageData } from '@/src/hooks/useSubscriptionPackageData';\r\nimport SubscriptionPackageTable from '@/src/components/subscription-packages/SubscriptionPackageTable';\r\nimport SubscriptionPackageForm from '@/src/components/subscription-packages/SubscriptionPackageForm';\r\nimport SubscriptionPackageSearchImportExport from '@/src/components/subscription-packages/SubscriptionPackageSearchImportExport';\r\nimport { exportSubscriptionPackagesToExcel } from '@/src/lib/subscriptionPackages/exportSubscriptionPackages';\r\nimport { SubscriptionPackage } from '@/src/lib/subscriptionPackages/subscriptionPackagesType';\r\n\r\ninterface Props {\r\n  companyId: string;\r\n}\r\n\r\nexport default function SubscriptionPackageManagerPage({ companyId }: Props) {\r\n  const {\r\n    packages,\r\n    loading,\r\n    error,\r\n    fetchPackages,\r\n    createPackage,\r\n    updatePackage,\r\n    deletePackage,\r\n  } = useSubscriptionPackageData(companyId);\r\n\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [editingPackage, setEditingPackage] = useState<SubscriptionPackage | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [durationFilter, setDurationFilter] = useState('');\r\n\r\n  const filteredPackages = packages.filter(pkg =>\r\n    pkg.name.toLowerCase().includes(searchTerm.toLowerCase()) &&\r\n    (durationFilter ? pkg.durationType === durationFilter : true)\r\n  );\r\n\r\n  const handleAddNew = () => {\r\n    setEditingPackage(null);\r\n    setShowForm(true);\r\n  };\r\n\r\n  const handleEdit = (pkg: SubscriptionPackage) => {\r\n    setEditingPackage(pkg);\r\n    setShowForm(true);\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (confirm('Are you sure you want to delete this package?')) {\r\n      await deletePackage(id);\r\n    }\r\n  };\r\n\r\n  const handleSave = async (data: Omit<SubscriptionPackage, 'id' | 'createdAt' | 'updatedAt'>) => {\r\n    if (editingPackage) {\r\n      await updatePackage(editingPackage.id!, data);\r\n    } else {\r\n      await createPackage({ ...data, companyId });\r\n    }\r\n    setShowForm(false);\r\n    setEditingPackage(null);\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    setShowForm(false);\r\n    setEditingPackage(null);\r\n  };\r\n\r\n  const handleImportComplete = async (imported: Omit<SubscriptionPackage, 'id' | 'createdAt' | 'updatedAt'>[]) => {\r\n    for (const pkg of imported) {\r\n      await createPackage(pkg);\r\n    }\r\n    await fetchPackages(); // Reload lại sau import\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <h1 className=\"text-2xl font-bold mb-6\">Manage Subscription Packages</h1>\r\n\r\n      {!showForm ? (\r\n        <>\r\n          <div className=\"flex justify-end mb-4\">\r\n            <button\r\n              className=\"px-4 py-2 bg-[#00d289] text-white rounded-xl hover:bg-[#00b07a] transition\"\r\n              onClick={handleAddNew}\r\n            >\r\n              Add New Package\r\n            </button>\r\n          </div>\r\n\r\n          <SubscriptionPackageSearchImportExport\r\n            packages={packages}\r\n            searchTerm={searchTerm}\r\n            setSearchTerm={setSearchTerm}\r\n            durationFilter={durationFilter}\r\n            setDurationFilter={setDurationFilter}\r\n            onExport={() => exportSubscriptionPackagesToExcel(filteredPackages)}\r\n            onImportComplete={handleImportComplete}\r\n          />\r\n\r\n          {loading ? (\r\n            <div>Loading...</div>\r\n          ) : error ? (\r\n            <div className=\"text-red-500\">{error}</div>\r\n          ) : (\r\n            <SubscriptionPackageTable\r\n              packages={filteredPackages}\r\n              onEdit={handleEdit}\r\n              onDelete={handleDelete}\r\n            />\r\n          )}\r\n        </>\r\n      ) : (\r\n        <SubscriptionPackageForm\r\n          initialData={editingPackage || undefined}\r\n          onSave={handleSave}\r\n          onCancel={handleCancel}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;;;;;;;;;;;;;;;;AAIA;AAPA;;;;;;;;AAce,SAAS,+BAA+B,EAAE,SAAS,EAAS;IACzE,MAAM,EACJ,QAAQ,EACR,OAAO,EACP,KAAK,EACL,aAAa,EACb,aAAa,EACb,aAAa,EACb,aAAa,EACd,GAAG,CAAA,GAAA,0IAAA,CAAA,6BAA0B,AAAD,EAAE;IAE/B,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACzC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAA8B;IACjF,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAErD,MAAM,mBAAmB,SAAS,MAAM,CAAC,CAAA,MACvC,IAAI,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,WAAW,WAAW,OACtD,CAAC,iBAAiB,IAAI,YAAY,KAAK,iBAAiB,IAAI;IAG9D,MAAM,eAAe;QACnB,kBAAkB;QAClB,YAAY;IACd;IAEA,MAAM,aAAa,CAAC;QAClB,kBAAkB;QAClB,YAAY;IACd;IAEA,MAAM,eAAe,OAAO;QAC1B,IAAI,QAAQ,kDAAkD;YAC5D,MAAM,cAAc;QACtB;IACF;IAEA,MAAM,aAAa,OAAO;QACxB,IAAI,gBAAgB;YAClB,MAAM,cAAc,eAAe,EAAE,EAAG;QAC1C,OAAO;YACL,MAAM,cAAc;gBAAE,GAAG,IAAI;gBAAE;YAAU;QAC3C;QACA,YAAY;QACZ,kBAAkB;IACpB;IAEA,MAAM,eAAe;QACnB,YAAY;QACZ,kBAAkB;IACpB;IAEA,MAAM,uBAAuB,OAAO;QAClC,KAAK,MAAM,OAAO,SAAU;YAC1B,MAAM,cAAc;QACtB;QACA,MAAM,iBAAiB,wBAAwB;IACjD;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;0BAA0B;;;;;;YAEvC,CAAC,yBACA;;kCACE,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC;4BACC,WAAU;4BACV,SAAS;sCACV;;;;;;;;;;;kCAKH,8OAAC;wBACC,UAAU;wBACV,YAAY;wBACZ,eAAe;wBACf,gBAAgB;wBAChB,mBAAmB;wBACnB,UAAU,IAAM,CAAA,GAAA,iKAAA,CAAA,oCAAiC,AAAD,EAAE;wBAClD,kBAAkB;;;;;;oBAGnB,wBACC,8OAAC;kCAAI;;;;;+BACH,sBACF,8OAAC;wBAAI,WAAU;kCAAgB;;;;;6CAE/B,8OAAC;wBACC,UAAU;wBACV,QAAQ;wBACR,UAAU;;;;;;;6CAKhB,8OAAC;gBACC,aAAa,kBAAkB;gBAC/B,QAAQ;gBACR,UAAU;;;;;;;;;;;;AAKpB","debugId":null}}]
}